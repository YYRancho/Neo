{"version":3,"sources":["../src/chatroom_ui.js"],"names":["$","document","ready","window","resize","message_list","Rolling","control_step","adjust_width","message_editor","user_list","event","console","log","fs","Number","css","slice","h_rem","Math","floor","height","each","index","ele","limit_height","append","width","remove","left_d1","offset","left","top_d1","top","s1","repeat","left_d2","top_d2","s2","font_size","selector","scroll_pos","scrollTop","step","scroll","resize_detection","retreat_detection","timer","setInterval","scrollHeight","clientHeight","clearInterval"],"mappings":"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","file":"chatroom_ui.js","sourcesContent":["'use strict';\n\n// ========== initial ==========\n$(document).ready(function() {\n    $(window).resize()\n\n    let message_list = new Rolling('#message-list')\n    message_list.control_step()\n    message_list.adjust_width(false, false)\n    let message_editor = new Rolling('#message-editor')\n    message_editor.control_step()\n    message_editor.adjust_width(false, true)\n    let user_list = new Rolling('#user-list')\n    user_list.control_step()\n    user_list.adjust_width(true, false)\n})\n\n// ========== Draw dividers and keep layout aligned ==========\n$(window).resize(function(event) {\n    console.log('window resize');\n\n    // in order to use rem unit\n    let fs = Number($('html').css('font-size').slice(0,-2))\n\n    // make the height of message-pane an integral multiple of line-height\n    let h_rem = Math.floor(Number($('body').height()-10)/fs)\n    h_rem = h_rem % 2 ? h_rem + 1 : h_rem\n    $('.main-content').height(`${h_rem}rem`)\n\n    // make the height of tip message wrappers an integral multiple of line-height\n    $('.message-wrapper').each(function(index, ele) {\n        ele = $(ele)\n        limit_height(ele,fs)\n    })\n\n    // set textarea placeholder vertical alignment\n    $('head').append(`<style type=\"text/css\">textarea::placeholder {line-height:${$('#send-my-message').height()}px !important;}</style>`)\n\n    // layout alignment\n    $('.function-pane').width($('.message-time').width())\n\n    // draw left divider\n    $('.left-divider').remove()\n    let left_d1 = $('.message-content').offset().left - 15 - 4\n    let top_d1 = $('.main-content').offset().top\n    let s1 = `<div class=\"left-divider\" style=\"top:${top_d1}px;left:${left_d1}px;\">`\n    s1 += '▎<br>'.repeat(h_rem/2)\n    s1 += '</div>'\n    $('body').append(s1)\n    // draw right divider\n    $('.right-divider').remove()\n    let left_d2 = $('.user-pane').offset().left - 15 - 4\n    let top_d2 = $('.rightbar').offset().top\n    let s2 = `<div class=\"right-divider\" style=\"top:${top_d2}px;left:${left_d2}px;\">`\n    s2 += '▎<br>'.repeat(h_rem/2)\n    s2 += '</div>'\n    $('body').append(s2)\n})\n\nfunction limit_height(ele,font_size) {\n    /*\n    here we need to clear old height parameter or it will influence the calculation\n    because the calculation need the new natural(not original and not modified by script) height number\n    after some layout changes\n    */\n    ele.height('')\n    ele.height(Math.floor(ele.height()/font_size) + 'rem')\n}\n\n// ========== scroll control ==========\nclass Rolling {\n    constructor(selector) {\n        this.ele = $(selector)\n        this.scroll_pos = this.ele.scrollTop()\n    }\n\n    // make every scroll step equal to line-height\n    control_step() {\n        let ele = this.ele\n        let scroll_pos = this.scroll_pos\n        let step = Number($('body').css('line-height').slice(0,-2))\n        ele.scroll(function(event) {\n            console.log('before:', scroll_pos, 'now:', ele.scrollTop())\n            if (ele.scrollTop() > scroll_pos) {\n                scroll_pos += step\n                while (ele.scrollTop() > scroll_pos) {\n                    scroll_pos += step\n                }\n                console.log('+')\n            } else if (ele.scrollTop() < scroll_pos){\n                scroll_pos -= step\n                while (ele.scrollTop() < scroll_pos) {\n                    scroll_pos -= step\n                }\n                console.log('-')\n            }\n            ele.scrollTop(scroll_pos)\n            console.log('*',ele.scrollTop())\n        })\n    }\n\n    adjust_width(resize_detection, retreat_detection) {\n        let ele = this.ele\n        let timer = setInterval(function() {\n            if (ele[0].scrollHeight > ele[0].clientHeight) {\n                // wider than 100%(parent element) to make the vertical scroll bar hidden\n                ele.width('calc(100% + 16px)')\n                ele.css('overflow-y', 'auto')\n\n                if (resize_detection) {\n                    $(window).resize()\n                }\n\n                if (!retreat_detection) {\n                    clearInterval(timer)\n                }\n            } else if (retreat_detection) {\n                ele.css('overflow-y', 'hidden')\n                ele.width('100%')\n            }\n        }, 500)\n    }\n}\n"]}