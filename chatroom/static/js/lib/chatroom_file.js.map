{"version":3,"sources":["../src/chatroom_file.js"],"names":["$","on","event","preventDefault","removeClass","remove","files","originalEvent","dataTransfer","file","size","alert","id","Math","random","toString","substr","append","time_now","format_time_now","split","fr","FileReader","readAsDataURL","onload","e","upload_my_file","onerror","console","log","addClass","css","offset","width","height","fd","FormData","text","ajax","method","url","data","contentType","processData","xhr","ajaxSettings","upload","onloadstart","onprogress","percent","loaded","total","toFixed","attr","done","response","fail","status","error"],"mappings":"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","file":"chatroom_file.js","sourcesContent":["'use strict';\n\n$('textarea').on('drop', function(event) {\n    event.preventDefault();\n    $(this).removeClass('file-area')\n    $('.fa-upload').remove()\n\n    let files = event.originalEvent.dataTransfer.files\n    for (let file of files) {\n        if (file.size > 200*1024*1024) { // judge whether file size > 200M\n            alert('The file size should not exceed 30M!')\n            return\n        }\n\n        // show progress bar\n        let id = Math.random().toString(36).substr(2) // use unique id to recognize different files\n        $('#message-list').append(`<div id=${id} class=\"message-wrapper\"></div>`)\n        let time_now = format_time_now()\n        $(`#${id}`).append(`<div class=\"message-time\">${time_now.split('.')[0]}</div>`)\n        $(`#${id}`).append(`<div class=\"message-content\"><span class=\"mark\">READING...</span></div>`)\n        $(`#${id} .message-content`).append(`<progress max=\"100\" value=\"0\"></progress>`)\n\n        // user FileReader to determine whether it is a file folder\n        let fr = new FileReader()\n        fr.readAsDataURL(file)\n        fr.onload = function(e) {\n            upload_my_file(file, id)\n        }\n        fr.onerror = function(e) {\n            alert('Only support uploading files but not uploading any file folder!')\n        }\n    }\n})\n$('textarea').on('dragenter', function(event) {\n    console.log('dragenter');\n    event.preventDefault();\n    $(this).addClass('file-area')\n    $('#send-my-message').append('<i class=\"fa fa-upload fa-5x\" style=\"position:absolute;\"></i>')\n    $('.fa-upload').css({\n        'left': $('textarea').offset()['left'] + 0.5*$('textarea').width() - 0.5*$('.fa-upload').width() + 'px',\n        'top': $('textarea').offset()['top'] + 0.5*$('textarea').height() - 0.5*$('.fa-upload').height() + 'px',\n    })\n})\n$('textarea').on('dragleave', function(event) {\n    console.log('dragleave');\n    event.preventDefault();\n    $(this).removeClass('file-area')\n    $('.fa-upload').remove()\n})\n$('textarea').on('dragover', function(event) {\n    console.log('dragover');\n    event.preventDefault();\n})\n\nfunction upload_my_file(file, id) {\n    let fd = new FormData()\n    fd.append('user_name',$('#name-editor').text())\n    fd.append('ip',$('#my-ip').text())\n    fd.append('file',file)\n\n    $.ajax({\n        method: 'POST',\n        url: '/upload_my_file',\n        data: fd,\n        contentType: false,\n        processData: false,\n        xhr: function() {\n            let xhr = $.ajaxSettings.xhr()\n            xhr.upload.onloadstart = function(e) {\n                $(`#${id} .mark`).text('UPLOADING...')\n            }\n            xhr.upload.onprogress = function(e) {\n                var percent = e.loaded / e.total;\n                $(`#${id} .mark`).text('UPLOADING... ' + (percent*100).toFixed(2) + '%')\n                $(`progress`).attr('value', percent*100)\n                console.log(percent);\n            }\n            xhr.upload.onload = function(e) {\n                $(`#${id} .mark`).text('SAVING...')\n            }\n            return xhr\n        },\n    })\n    .done(function(response) {\n        $(`#${id}`).remove()\n        console.log(\"upload my file SUCCESS\");\n        console.log(response);\n    })\n    .fail(function(xhr, status, error) {\n        console.log(\"upload my file FAIL:\", xhr.status, status, '\\n', error);\n    })\n}\n"]}